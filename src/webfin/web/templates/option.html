{%- extends "base.html" %}
{%- block content %}
<div class="container" style="width:80%">
	<form id="option-form">
		<div class="form-group">
			<label for="spot">Spot</label>
			<input type="number" step="0.001" class="form-control" id="spot" aria-describedby="spotHelp" placeholder="e.g. 1.3" required>
			<small id="spotlHelp" class="form-text text-muted">Spot price</small>
		</div>
		<div class="form-group">
			<label for="strike">Strike</label>
			<input type="number" step="0.001" class="form-control" id="strike" aria-describedby="strikeHelp" placeholder="e.g. 1.3" required>
			<small id="strikelHelp" class="form-text text-muted">Strike</small>
		</div>
		<div class="form-group">
			<label for="tenor">Tenor</label>
			<select class="form-control" id="tenor" required>
				<!-- <option selected>Choose...</option> -->
				{%- for value, display in form.tenor.choices %}
				<option value="{{ value }}">{{ display }}</option>
				{%- endfor %}
			</select>
			<small id="tenorlHelp" class="form-text text-muted">Tenor</small>
		</div>
		<div class="form-group">
			<label for="rate">Rate</label>
			<input type="number" step="0.001" class="form-control" id="rate" aria-describedby="rateHelp" placeholder="e.g. 0.533" required>
			<small id="ratelHelp" class="form-text text-muted">Risk Free Rate</small>
		</div>
		<div class="form-group">
			<label for="volatility">Volatility</label>
			<input type="number" step="0.001" class="form-control" id="volatility" aria-describedby="volatilityHelp" placeholder="e.g. 0.39" required>
			<small id="volatilitylHelp" class="form-text text-muted">Volatility</small>
		</div>
		<div class="form-group">
			<div class="form-check">
				<input class="form-check-input" type="radio" name="solveFor" id="premium" value="premium" checked>
				<label class="form-check-label" for="premium">
					Solve for Premium
				</label>
			</div>
			<div class="form-check">
				<input class="form-check-input" type="radio" name="solveFor" id="vega" value="vega">
				<label class="form-check-label" for="vega">
					Solve for Vega
				</label>
			</div>
		</div>
		<div class="form-group">
			<label for="premium">Premium</label>
			{%- if premium %}
			<input type="number" id="answer" class="form-control" placeholder="{{ premium }}" disabled>
			{%- else %}
			<input type="number" id="answer" class="form-control" placeholder="Hit submit button to calculate" disabled>
			{%- endif %}
		</div>
		<button type="submit" class="btn btn-primary">Submit</button>
	</form>
</div>

	<script>
		document.addEventListener('submit', async function (event) {
			event.preventDefault();
			console.log("submitted");
			form = document.querySelector("form");
			let payload = {
				"spot": document.querySelector("#spot").value,
				"strike": document.querySelector("#strike").value,
				"tenor": document.querySelector("#tenor").value,
				"rate": document.querySelector("#rate").value,
				"volatility": document.querySelector("#volatility").value
			};
			console.log(payload);
			let solveFor = document.querySelector("#premium");

			let url = solveFor.checked?"{{ url('premium') }}":"{{ url('vega') }}";
			let response = await fetch(url, {
				method: "POST",
				headers: {
					'Content-Type': 'application/json;charset=utf-8'
				},
				body: JSON.stringify(payload)
			});
			let result = await response.json();
			console.log(JSON.stringify(result));
			let answerElement = document.querySelector("#answer");
			answerElement.value = result.value
		})
</script>
{%- endblock %}
